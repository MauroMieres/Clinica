<div class="fondo-clinica">
  <div class="container d-flex justify-content-center align-items-center min-vh-100">
<div class="container py-4">
  <h2 class="mb-4">Mis turnos</h2>

  <table class="table table-bordered table-hover" *ngIf="turnos.length > 0">
    <thead class="table-light">
      <tr>
        <th>Fecha</th>
        <th>Especialista</th>
        <th>Especialidad</th>
        <th>Estado</th>
        <th>Reseña</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let turno of turnos">
        <td>{{ turno.fecha_inicio | date:'dd/MM HH:mm' }} a {{ turno.fecha_fin | date:'HH:mm' }}hs</td>
        <td>{{ turno.especialistas?.nombre }}</td>
<td>{{ turno.especialidades?.nombre }}</td>

        <td>{{ turno.estado }}</td>
        <td>{{ turno.resena || '-' }}</td>
        <td>
          <button *ngIf="turno.estado === 'solicitado'" class="btn btn-danger btn-sm" (click)="cancelarTurno(turno)">
            Cancelar
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <p *ngIf="turnos.length === 0">No tenés turnos registrados.</p>

  <button *ngIf="userRole === 'paciente'" class="btn btn-primary mt-4" (click)="abrirSolicitud()">
  Solicitar nuevo turno
</button>


  <div *ngIf="modoSolicitud" class="mt-5">
  <h4>Solicitar Turno</h4>

  <div class="mb-3">
    <label>Buscar por:</label>
    <select class="form-select" [(ngModel)]="modoBusqueda">
      <option value="especialidad">Especialidad</option>
      <option value="especialista">Especialista</option>
    </select>
  </div>

  <div *ngIf="modoBusqueda === 'especialidad'" class="mb-3">
    <label>Especialidad:</label>
    <select class="form-select" [(ngModel)]="especialidadSeleccionada" (change)="cargarEspecialistasPorEspecialidad()">
      <option *ngFor="let esp of especialidades" [value]="esp.id">{{ esp.nombre }}</option>
    </select>

    <label class="mt-3">Especialistas:</label>
    <select class="form-select" [(ngModel)]="especialistaSeleccionado" (change)="cargarHorariosDisponibles()">
      <option *ngFor="let esp of especialistasFiltrados" [value]="esp.id">{{ esp.nombre }}</option>
    </select>
  </div>

  <div *ngIf="modoBusqueda === 'especialista'" class="mb-3">
    <label>Especialista:</label>
    <select class="form-select" [(ngModel)]="especialistaSeleccionado" (change)="cargarEspecialidadesPorEspecialista()">
      <option *ngFor="let esp of especialistas" [value]="esp.id">{{ esp.nombre }}</option>
    </select>

    <label class="mt-3">Especialidad:</label>
    <select class="form-select" [(ngModel)]="especialidadSeleccionada" (change)="cargarHorariosDisponibles()">
      <option *ngFor="let esp of especialidadesFiltradas" [value]="esp.id">{{ esp.nombre }}</option>
    </select>
  </div>

  <div *ngIf="horariosDisponibles.length > 0" class="mt-4">
    <label class="form-label mt-3">Seleccione un horario:</label>
<select class="form-select" [(ngModel)]="horarioSeleccionado">
  <option *ngFor="let h of horariosDisponibles" [ngValue]="h">
    {{ h.fecha_inicio | date: 'dd/MM HH:mm' }} a {{ h.fecha_fin | date: 'HH:mm' }}hs
  </option>
</select>

  </div>

  <button class="btn btn-success mt-3" [disabled]="!horarioSeleccionado" (click)="confirmarTurno()">Confirmar turno</button>
</div>

</div>
